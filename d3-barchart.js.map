{"version":3,"file":"d3-barchart.js","sources":["../../../home/runner/work/stanza-test/stanza-test/stanzas/d3-barchart/index.js"],"sourcesContent":["import 'https://d3js.org/d3.v5.min.js';\n\nexport default async function d3Barchart(stanza, params) {\n  const dataUrl = params[\"data-url\"];\n  if (!dataUrl) {\n    return;\n  }\n  const rawData = await fetch(dataUrl).then((res) => res.json());\n  const receivedData = rawData.filter(Boolean);\n\n  stanza.render({\n    template: \"stanza.html.hbs\",\n    parameters: {\n      dataUrl,\n      receivedData: JSON.stringify(receivedData.slice(0, 3), null, \"  \"),\n    },\n  });\n\n  const width = 400;\n  const height = 300;\n  const padding = 40;\n  const category = params['category'];\n  const value = params['value'];\n\n  // 2.set SVG area\n  const chartElement = stanza.root.querySelector('#chart');\n  const svg = d3.select(chartElement).append(\"svg\").attr(\"width\", width).attr(\"height\", height);\n\n  // 3. set scale\n  const xScale = d3.scaleBand()\n    .rangeRound([padding, width - padding])\n    .padding(0.5)\n    .domain(receivedData.map(function (d) { return d[category]; }));\n  // .domain(receivedData.map(function (d) { \n  //   console.log('d.count',d.count)\n  //   return d.category; }));\n\n  const yScale = d3.scaleLinear()\n    .domain([0, 2000])\n    // .domain([0, \n    //   // d3.max(receivedData, function(d) { return d.count; })\n    //   d3.max(receivedData.map(d => d.count))\n    // ])\n    // .domain([0, d3.max(receivedData, function(d) { return d.count; })])\n    .range([height - padding, padding]);\n\n  // 4. set axis\n  svg.append(\"g\")\n    .attr(\"transform\", \"translate(\" + 0 + \",\" + (height - padding) + \")\")\n    .call(d3.axisBottom(xScale));\n\n  svg.append(\"g\")\n    .attr(\"transform\", \"translate(\" + padding + \",\" + 0 + \")\")\n    .call(d3.axisLeft(yScale));\n\n  // 5. set rect(bar)\n  svg.append(\"g\")\n    .selectAll(\"rect\")\n    .data(receivedData)\n    .enter()\n    .append(\"rect\")\n    .attr(\"x\", function (d) { return xScale(d[category]); })\n    .attr(\"y\", function (d) { return yScale(d[value]); })\n    .attr(\"width\", xScale.bandwidth())\n    .attr(\"height\", function (d) { return height - padding - yScale(d[value]); })\n    .attr(\"fill\", \"lightblue\")\n    .attr(\"class\", \"rect\")\n    .on(\"click\", function () {\n      // access event by [d3.event]\n      d3.event.preventDefault();\n\n      stanza.host.dispatchEvent(\n        new CustomEvent(\"clickedData\", {\n          detail: {\n            \"category\": function (d) { return d[category] },\n            \"count\": function (d) { return d[value] }\n          }\n        })\n      );\n    });\n}"],"names":[],"mappings":"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"}